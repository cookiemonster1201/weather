{"ast":null,"code":"import { createAsyncThunk, createSlice } from \"@reduxjs/toolkit\";\nimport axios from \"axios\";\nimport { useSelector } from \"react-redux\";\nimport { getCountries } from \"../countries/countriesSelectors\"; // axios.defaults.baseURL = 'https://api.openweathermap.org/data/2.5';\n\nconst updateElById = (arr, idx, updateData) => arr.map((item, id, arr) => arr.indexOf(item) === idx ? updateData : item);\n\nconst deleteCity = (arr, name) => {\n  console.log(arr, name);\n  return arr.filter(el => name !== el.name);\n};\n\nexport const updateWeatherAction = createAsyncThunk(\"weather/updateWeather\", async (payload, _ref) => {\n  let {\n    rejectWithValue,\n    getState,\n    dispatch\n  } = _ref;\n  const {\n    lat,\n    lon,\n    idx\n  } = payload;\n\n  try {\n    const {\n      data\n    } = await axios.get(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=d0aef4da9ac1a34e09e4ce9ff137ae24&units=imperial`);\n    return {\n      data,\n      idx\n    };\n  } catch (error) {\n    var _error$response;\n\n    if (!(error !== null && error !== void 0 && error.response)) {\n      throw error;\n    }\n\n    return rejectWithValue(error === null || error === void 0 ? void 0 : (_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.data);\n  }\n});\nconst countriesSlice = createSlice({\n  name: 'countries',\n  initialState: {\n    arr: [],\n    error: null,\n    loading: false\n  },\n  reducers: {\n    addCountry: (state, _ref2) => {\n      let {\n        payload\n      } = _ref2;\n      state.arr = !state.arr.includes(payload) ? [...state.arr, payload] : state.arr;\n    },\n    removeCountry: (state, _ref3) => {\n      let {\n        payload\n      } = _ref3;\n      state.arr = deleteCity(state.arr, payload);\n    } // updateCountry: (state, {payload}) => {state.arr = updateElById(state.arr, payload.idx, payload.data)}\n\n  },\n  extraReducers: {\n    [updateWeatherAction.pending]: (state, action) => {\n      state.loading = true;\n    },\n    [updateWeatherAction.fulfilled]: (state, _ref4) => {\n      let {\n        payload\n      } = _ref4;\n      state.arr = updateElById(state.arr, payload.idx, payload.data);\n    },\n    //     .addCase(updateWeatherAction.fulfilled, (state, {payload}) => {\n    //             state.loading = false,\n    //             state.error = null\n    //         }\n    // )\n    //     .addCase(updateWeatherAction.fulfilled, (state, action) => {\n    //         const findIndex = state.arr.reduce((acc, country, index) => \n    //             if (country.name === action.payload.name) {\n    //                 return acc += index\n    //             }\n    //             return acc;\n    //         }, 0)\n    //         return {\n    //             state.arr[findIndex] = action.payload,\n    //             state.loading = false,\n    //             state.error = null\n    //         }\n    //     }\n    // )\n    [updateWeatherAction.rejected]: (state, action) => {\n      state.error = action === null || action === void 0 ? void 0 : action.payload;\n      state.loading = false;\n    }\n  }\n});\nexport const {\n  addCountry,\n  removeCountry\n} = countriesSlice.actions;\nexport default countriesSlice.reducer;","map":{"version":3,"sources":["/Users/alenamikituk/Documents/IT/weather/src/redux/slices/countriesSlice.js"],"names":["createAsyncThunk","createSlice","axios","useSelector","getCountries","updateElById","arr","idx","updateData","map","item","id","indexOf","deleteCity","name","console","log","filter","el","updateWeatherAction","payload","rejectWithValue","getState","dispatch","lat","lon","data","get","error","response","countriesSlice","initialState","loading","reducers","addCountry","state","includes","removeCountry","extraReducers","pending","action","fulfilled","rejected","actions","reducer"],"mappings":"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","sourcesContent":["import { createAsyncThunk, createSlice } from \"@reduxjs/toolkit\";\nimport axios from \"axios\";\nimport { useSelector } from \"react-redux\";\nimport { getCountries } from \"../countries/countriesSelectors\";\n// axios.defaults.baseURL = 'https://api.openweathermap.org/data/2.5';\n\nconst updateElById = (arr, idx, updateData) => arr.map((item, id, arr) => arr.indexOf(item) === idx ? updateData : item)\n\nconst deleteCity = (arr, name) => {\n  console.log(arr, name)\n  return arr.filter((el) => name !== el.name)\n}\n\nexport const updateWeatherAction = createAsyncThunk(\n  \"weather/updateWeather\",\n    async (payload, { rejectWithValue, getState, dispatch }) => {\n        const { lat, lon, idx } = payload;\n        try {\n          const { data } = await axios.get(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=d0aef4da9ac1a34e09e4ce9ff137ae24&units=imperial`);\n          return {data, idx}\n      } catch (error) {\n      if (!error?.response) {\n        throw error;\n      }\n      return rejectWithValue(error?.response?.data);\n    }\n  }\n);\n\nconst countriesSlice = createSlice({\n    name: 'countries',\n    initialState: {\n        arr: [],\n        error: null,\n        loading:false\n    },\n    reducers: {\n        addCountry: (state, { payload }) => {\n          state.arr = !state.arr.includes(payload) ? [...state.arr, payload] : state.arr\n        },\n        removeCountry: (state, { payload }) => {\n        state.arr = deleteCity(state.arr, payload) \n        },\n        // updateCountry: (state, {payload}) => {state.arr = updateElById(state.arr, payload.idx, payload.data)}\n        \n    },\n    extraReducers: {\n          [updateWeatherAction.pending]: (state, action) => {\n            state.loading = true;\n            },\n          [updateWeatherAction.fulfilled]: (state, { payload }) => {\n            state.arr = updateElById(state.arr, payload.idx, payload.data)\n            },\n        //     .addCase(updateWeatherAction.fulfilled, (state, {payload}) => {\n        //             state.loading = false,\n        //             state.error = null\n        //         }\n        // )\n        //     .addCase(updateWeatherAction.fulfilled, (state, action) => {\n        //         const findIndex = state.arr.reduce((acc, country, index) => \n        //             if (country.name === action.payload.name) {\n        //                 return acc += index\n        //             }\n        //             return acc;\n        //         }, 0)\n        //         return {\n        //             state.arr[findIndex] = action.payload,\n        //             state.loading = false,\n        //             state.error = null\n        //         }\n        //     }\n        // )\n        [updateWeatherAction.rejected]: (state, action) => {\n            state.error = action?.payload;\n            state.loading = false;\n            }\n          }  \n})\n\n\nexport const { addCountry,removeCountry } = countriesSlice.actions;\nexport default countriesSlice.reducer;"]},"metadata":{},"sourceType":"module"}