{"ast":null,"code":"import { createAsyncThunk, createSlice } from \"@reduxjs/toolkit\";\nimport axios from \"axios\";\nimport { useSelector } from \"react-redux\";\nimport { getCountries } from \"../countries/countriesSelectors\"; // axios.defaults.baseURL = 'https://api.openweathermap.org/data/2.5';\n\nconst updateElById = (arr, idx, updateData) => arr.map((item, id, arr) => arr.indexOf(item) === idx ? updateData : item);\n\nexport const updateWeatherAction = createAsyncThunk(\"weather/updateWeather\", async (payload, _ref) => {\n  let {\n    rejectWithValue,\n    getState,\n    dispatch\n  } = _ref;\n  const {\n    lat,\n    lon,\n    idx\n  } = payload; // const countries = useSelector(getCountries)\n\n  try {\n    console.log('upgating');\n    const {\n      data\n    } = await axios.get(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=7318f9d16165f2ed696d529c2a4bcc86`); //   countries[idx] = data;\n\n    const newData = { ...data,\n      sasha: 'great',\n      idx: idx\n    };\n    return {\n      newData,\n      idx\n    };\n  } catch (error) {\n    var _error$response;\n\n    if (!(error !== null && error !== void 0 && error.response)) {\n      throw error;\n    }\n\n    return rejectWithValue(error === null || error === void 0 ? void 0 : (_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.data);\n  }\n});\nconst countriesSlice = createSlice({\n  name: 'countries',\n  initialState: {\n    arr: [],\n    error: null,\n    loading: false\n  },\n  reducers: {\n    addCountry: (state, _ref2) => {\n      let {\n        payload\n      } = _ref2;\n      state.arr.push(payload);\n    },\n    removeCountry: (state, _ref3) => {\n      let {\n        payload\n      } = _ref3;\n      state.arr = state.arr.filter(c => c.name !== payload);\n    },\n    updateCountry: (state, _ref4) => {\n      let {\n        payload\n      } = _ref4;\n      state.arr = updateElById(state.arr, payload.idx, payload.data);\n    }\n  },\n  extraReducers: builder => {\n    builder.addCase(updateWeatherAction.pending, (state, action) => {\n      state.loading = true;\n    }).addCase(updateWeatherAction.fulfilled, (state, _ref5) => {\n      let {\n        payload\n      } = _ref5;\n      state.arr = [payload];\n    }) //     .addCase(updateWeatherAction.fulfilled, (state, {payload}) => {\n    //             state.loading = false,\n    //             state.error = null\n    //         }\n    // )\n    //     .addCase(updateWeatherAction.fulfilled, (state, action) => {\n    //         const findIndex = state.arr.reduce((acc, country, index) => \n    //             if (country.name === action.payload.name) {\n    //                 return acc += index\n    //             }\n    //             return acc;\n    //         }, 0)\n    //         return {\n    //             state.arr[findIndex] = action.payload,\n    //             state.loading = false,\n    //             state.error = null\n    //         }\n    //     }\n    // )\n    .addCase(updateWeatherAction.rejected, (state, action) => {\n      state.error = action === null || action === void 0 ? void 0 : action.payload;\n      state.loading = false;\n    });\n  }\n});\nexport const {\n  addCountry,\n  removeCountry\n} = countriesSlice.actions;\nexport default countriesSlice.reducer;","map":{"version":3,"sources":["/Users/alenamikituk/weather/src/redux/slices/countriesSlice.js"],"names":["createAsyncThunk","createSlice","axios","useSelector","getCountries","updateElById","arr","idx","updateData","map","item","id","indexOf","updateWeatherAction","payload","rejectWithValue","getState","dispatch","lat","lon","console","log","data","get","newData","sasha","error","response","countriesSlice","name","initialState","loading","reducers","addCountry","state","push","removeCountry","filter","c","updateCountry","extraReducers","builder","addCase","pending","action","fulfilled","rejected","actions","reducer"],"mappings":"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","sourcesContent":["import { createAsyncThunk,createSlice } from \"@reduxjs/toolkit\";\nimport axios from \"axios\";\nimport { useSelector } from \"react-redux\";\nimport { getCountries } from \"../countries/countriesSelectors\";\n// axios.defaults.baseURL = 'https://api.openweathermap.org/data/2.5';\n\nconst updateElById = (arr, idx, updateData) => arr.map((item, id, arr) => arr.indexOf(item) === idx ? updateData : item)\n\nexport const updateWeatherAction = createAsyncThunk(\n  \"weather/updateWeather\",\n    async (payload, { rejectWithValue, getState, dispatch }) => {\n        const { lat, lon, idx } = payload;\n        // const countries = useSelector(getCountries)\n        try {\n        console.log('upgating')\n\n          const { data } = await axios.get(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=7318f9d16165f2ed696d529c2a4bcc86`);\n        //   countries[idx] = data;\n            const newData = {...data, sasha:'great', idx:idx}\n          return {newData, idx};\n      } catch (error) {\n      if (!error?.response) {\n        throw error;\n      }\n      return rejectWithValue(error?.response?.data);\n    }\n  }\n);\n\nconst countriesSlice = createSlice({\n    name: 'countries',\n    initialState: {\n        arr: [],\n        error: null,\n        loading:false\n    },\n    reducers: {\n        addCountry: (state, { payload }) => {state.arr.push(payload)},\n        removeCountry: (state, { payload }) => { state.arr = state.arr.filter(c => c.name !== payload) },\n        updateCountry: (state, {payload}) => {state.arr = updateElById(state.arr, payload.idx, payload.data)}\n        \n    },\n    extraReducers: builder => { \n        builder\n            .addCase(updateWeatherAction.pending, (state, action) => {\n            state.loading = true;\n            })\n            .addCase(updateWeatherAction.fulfilled, (state, { payload }) => {\n                    state.arr=[payload]\n            })\n        //     .addCase(updateWeatherAction.fulfilled, (state, {payload}) => {\n        //             state.loading = false,\n        //             state.error = null\n        //         }\n        // )\n        //     .addCase(updateWeatherAction.fulfilled, (state, action) => {\n        //         const findIndex = state.arr.reduce((acc, country, index) => \n        //             if (country.name === action.payload.name) {\n        //                 return acc += index\n        //             }\n        //             return acc;\n        //         }, 0)\n        //         return {\n        //             state.arr[findIndex] = action.payload,\n        //             state.loading = false,\n        //             state.error = null\n        //         }\n        //     }\n        // )\n        .addCase(updateWeatherAction.rejected, (state, action) => {\n            state.error = action?.payload;\n            state.loading = false;\n            });\n    }\n    \n})\nexport const { addCountry,removeCountry } = countriesSlice.actions;\nexport default countriesSlice.reducer;"]},"metadata":{},"sourceType":"module"}